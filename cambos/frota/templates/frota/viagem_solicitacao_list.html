{% extends "cambos/base_frota.html" %}
{% load static %}
{% block css %}

{% endblock css %}

{% block navigation %}
    <div class="row">		
        <ol class="breadcrumb ">
            <li><a href="{% url 'frota_index' %}">
                <em class="fa fa-home"></em>
            </a></li>
            <li class="active"><a href="{% url 'veiculo_list' %}">Veículos</a></li>
			<li class="active"><a href="{% url 'viagem_list' viag.veiculo.pk %}">Lista de Viagens</a></li>
        </ol>	
    </div><!--/.row-->
	
	<div class="row">
        <div class="col-lg-12">
			<h4><b>Viagem :</b></h4>
			<p>
				Veículo: 
				<strong>{{viag.veiculo}}</strong>
			</p>
			<p>
				Destino: 
				<strong>{{viag.destino}}</strong>
			</p>
			<p>
				Motorista: 
				<strong>{{viag.motorista.nome}} / {{viag.motorista2.nome}}</strong>
			</p>
			<p>
				Data Saída: 
				<strong>{{viag.data_inicial|date:"d/m/Y"}} </strong>
			</p>
			{% if peso > 1 and peso <= 13500%}
			<p>
				Peso Total: 
				<strong>{{peso}} </strong>
			</p>
			{% elif peso > 13500 %}
			<p>
				Peso Total: 
				<strong class="text-danger"> {{peso}}! PESO EXCEDEU O LIMITE MÁXIMO PERMITIDO !</strong></strong>
			</p>
			{% endif %}
        </div>
    </div><!--/.row-->
{% endblock navigation %}

{% block content %}		
<div class="col-12">	
	<div class="panel panel-default">
		<div class="panel-body">
			<table id="table"				
				data-toolbar="#toolbar"
				data-toggle="table"
				data-show-refresh="false"
				data-show-toggle="false"
				data-show-columns="true"
				data-search="true"
				data-select-item-name="toolbar"
				data-pagination="true"				 
				data-sort-order="desc"
			 >
				<thead>
					<tr>
						<th class="text-center">Solicitante</th>
						<th class="text-center">Tipo</th>
						<th class="text-center">Prioridade</th>
						<th class="text-center">Produto</th>
						<th class="text-center">Peso</th>
						<th class="text-center">Quantidade</th>
						<th class="text-center">Rua</th>
						<th class="text-center">Número</th>
						<th class="text-center">Bairro</th>
						<th class="text-center">Cidade</th>
						<th class="text-center">UF</th>
						<th class="text-center">CEP</th>
						<th data-field="Data Prevista" class='text-center'>Data Prevista</th>
						<th data-field="Data Solicitação"class='text-center'>Data Solicitação</th>
						<th class='text-center'>-</th>
					</tr>
				</thead>
				<tbody>
					{% for data in lista_solicitacoes %}
						{% if data.has_item == True %}
						{% for item in itemviagem %}
							{% if item.viagem_solicitacao == data and item.viagem == viag %}
								<tr data-href="#"
									class="trLink" >
									<td class='text-center'>
										{{data.user}}
									</td>
									<td class='text-center'>
										{% if data.tipo == '1' %}
											Coleta
										{% elif data.tipo == '2' %}
											Entrega
										{% elif data.tipo == '3' %}
											Coleta Direta
										{% elif data.tipo == '4' %}
											Entrada Direta
										{% endif %}
									</td>
									<td class='text-center' >																																									
										{%if data.prioridade == '2' %} 							
											Urgente
										{%elif data.prioridade == '1' %} 						
											Normal
										{%endif%}																																			
									</td>
									<td class='text-center'>{{ data.produtos }}</td>
									<td class='text-center'>{{ data.peso }}</td>
									<td class='text-center'>{{ data.quantidade }}</td>
									<td class='text-center'>
										{{data.endereco.endereco}}
									</td>
									<td class='text-center'>
										{{data.endereco.numero}}
									</td>
									<td class='text-center'>
										{{data.endereco.bairro}}
									</td>
									<td class='text-center'>
										{{data.endereco.cidade}}
									</td>
									<td class='text-center'>
										{{data.endereco.uf}}
									</td>
									<td class='text-center'>
										{{data.endereco.cep}}
									</td>
									<td class='text-center'>{{ data.data_prevista|date:"d/m/y" }}</td>
									<td class='text-center'>{{ data.data_solicitacao|date:"d/m/y H:i" }}</td>
									<td class='text-center'>
										<form class="" id="" method="submit">
											<!-- {% if data.has_item == True %} -->
											<button class="fas fa-dolly-flatbed btn btn-danger" type="submit" role="button" value="null">
												Cancelar Solicitação
											</button>
											<input type="hidden" class="form-control" id="editar" name="editar"
												value="false" placeholder="editar"
												aria-label="editar" aria-describedby="basic-addon1">
	
											<input type="hidden" id="solicitacao_id" name="solicitacao_id" value="{{ data.pk }}" placeholder="solicitacao_id" aria-label="solicitacao_id"/>
											<!-- {% else %}
											<button class="fas fa-dolly-flatbed btn btn-primary" type="submit" role="button" value="null">
												Atribuir Solicitação
											</button>
											<input type="hidden" class="form-control" id="editar" name="editar"
												value="true" placeholder="editar"
												aria-label="editar" aria-describedby="basic-addon1">
	
											<input type="hidden" id="solicitacao_id" name="solicitacao_id" value="{{ data.pk }}" placeholder="solicitacao_id" aria-label="solicitacao_id"/> -->
											<!-- {% endif %} -->
										</form>
									</td>
							{% endif %}
						{%endfor%}
						{% elif data.situacao == '1' %}
							<tr data-href="#"
									class="trLink" >
									<td class='text-center'>
										{{data.user}}
									</td>
									<td class='text-center'>
										{% if data.tipo == '1' %}
											Coleta
										{% elif data.tipo == '2' %}
											Entrega
										{% elif data.tipo == '3' %}
											Coleta Direta
										{% elif data.tipo == '4' %}
											Entrada Direta
										{% endif %}
									</td>
									<td class='text-center' >																																									
										{%if data.prioridade == '2' %} 							
											Urgente
										{%elif data.prioridade == '1' %} 						
											Normal
										{%endif%}																																			
									</td>
									<td class='text-center'>{{ data.produtos }}</td>
									<td class='text-center'>{{ data.peso }}</td>
									<td class='text-center'>{{ data.quantidade }}</td>
									<td class='text-center'>
										{{data.endereco.endereco}}
									</td>
									<td class='text-center'>
										{{data.endereco.numero}}
									</td>
									<td class='text-center'>
										{{data.endereco.bairro}}
									</td>
									<td class='text-center'>
										{{data.endereco.cidade}}
									</td>
									<td class='text-center'>
										{{data.endereco.uf}}
									</td>
									<td class='text-center'>
										{{data.endereco.cep}}
									</td>
									<td class='text-center'>{{ data.data_prevista|date:"d/m/y" }}</td>
									<td class='text-center'>{{ data.data_solicitacao|date:"d/m/y H:i" }}</td>
									<td class='text-center'>
										<form class="" id="" method="submit">
											<!-- {% if data.has_item == True %}
											<button class="fas fa-dolly-flatbed btn btn-danger" type="submit" role="button" value="null">
												Cancelar Solicitação
											</button>
											<input type="hidden" class="form-control" id="editar" name="editar"
												value="false" placeholder="editar"
												aria-label="editar" aria-describedby="basic-addon1">
	
											<input type="hidden" id="solicitacao_id" name="solicitacao_id" value="{{ data.pk }}" placeholder="solicitacao_id" aria-label="solicitacao_id"/>
											{% else %} -->
											<button class="fas fa-dolly-flatbed btn btn-primary" type="submit" role="button" value="null">
												Atribuir Solicitação
											</button>
											<input type="hidden" class="form-control" id="editar" name="editar"
												value="true" placeholder="editar"
												aria-label="editar" aria-describedby="basic-addon1">
	
											<input type="hidden" id="solicitacao_id" name="solicitacao_id" value="{{ data.pk }}" placeholder="solicitacao_id" aria-label="solicitacao_id"/>
											<!-- {% endif %} -->
										</form>
									</td>
						{%endif%}
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>
{%endblock content%}


{% block script %}

<script>	
	var tr = document.getElementsByClassName('tr-id');
tr.onclick = function (e) {
  location.href = 'http://www.google.com';
};
</script>
<script src="https://momentjs.com/downloads/moment.min.js"></script>
<script>
	function dateFormat(value, row, index) {
		return moment(value).format('DD/MM/YYYY');
	}	
</script>

<script>
	function dateSorter(a, b) {
		var aa = a.replace('$', '')
		var bb = b.replace('$', '')
		return aa - bb
		}
  </script>
  <script>
	
	$('#table').bootstrapTable({
		onClickRow: function (item, $element) {return  window.location = $element.data('href');},
	});

</script>
	
{% endblock script %}

